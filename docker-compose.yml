services:
  gempa_monitor:
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      - SLACK_WEBHOOK=${SLACK_WEBHOOK}
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TELEGRAM_CHAT_ID=${TELEGRAM_CHAT_ID}
      - SEND_TO_SLACK=${SEND_TO_SLACK}
      - SEND_TO_TELEGRAM=${SEND_TO_TELEGRAM}
      - CUACA_WILAYAH=${CUACA_WILAYAH}
      - CUACA_WILAYAH=${CUACA_WILAYAH:-34.71.08.1001,34.02.10.2001,34.02.15.2004,34.02.01.2001}
    volumes:
      - ./data:/data
    dns:
      - 8.8.8.8
      - 8.8.4.4
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "php", "-r", "file_exists('/data/gempa.db') || exit(1);"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    deploy:
      resources:
        limits:
          memory: 256M
        reservations:
          memory: 128M
